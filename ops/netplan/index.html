<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Netplan 配置示例 - Kain&#039;s Notes</title><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://kainonly.com/ops/netplan/"},"headline":"Netplan 配置示例","image":["https://kainonly.com/img/og_image.png"],"datePublished":"2021-05-16T01:36:05.180Z","dateModified":"2021-05-26T00:49:50.451Z","author":{"@type":"Person","name":"Kain"},"description":"以下是常见方案的示例 Netplan 配置的集合。如果您看不到某个场景或有一个场景可以做出贡献，可反馈至 Netplan configuration examples - Report a bug with this site"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/vs2015.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-J0NVPEBDTM" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-J0NVPEBDTM');</script><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="Kain&#039;s Notes" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" target="_blank" rel="noopener" href="https://www.yuque.com/kainonly">语雀</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/archives">归档</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/kainonly"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-05-16T01:36:05.180Z" title="2021/5/16 上午9:36:05">2021-05-16</time>发表</span><span class="level-item"><time dateTime="2021-05-26T00:49:50.451Z" title="2021/5/26 上午8:49:50">2021-05-26</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E8%BF%90%E7%BB%B4%E6%8A%80%E6%9C%AF/">运维技术</a></span><span class="level-item">16 分钟读完 (大约2348个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Netplan 配置示例</h1><div class="content"><p>以下是常见方案的示例 Netplan 配置的集合。如果您看不到某个场景或有一个场景可以做出贡献，可反馈至 <a target="_blank" rel="noopener" href="https://netplan.io/examples/">Netplan configuration examples</a> - <a target="_blank" rel="noopener" href="https://github.com/canonical-web-and-design/netplan.io/issues/new">Report a bug with this site</a></p>
<span id="more"></span>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>配置 netplan ,可以到 <code>/etc/netplan</code> 目录下找到扩展名 <code>.yaml</code> 配置文件（例如：<code>/etc/netplan/config.yaml</code> ）进行修改，然后执行 <code>sudo netplan apply</code> 解析配置并运用至应用系统中。在 <code>/etc/ netplan/</code> 下写入磁盘的配置将在两次重启之间保持不变。</p>
<h2 id="使用-DHCP-和-静态地址"><a href="#使用-DHCP-和-静态地址" class="headerlink" title="使用 DHCP 和 静态地址"></a>使用 DHCP 和 静态地址</h2><p>假设名为 <code>enp3s0</code> 的接口通过 DHCP 获得地址，可创建具有以下内容的 YAML 文件：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp3s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>如果设置静态 IP 地址，请使用地址键，该键获取（IPv4 或 IPv6），地址以及子网前缀长度（例如 /24）的列表。 也可以提供网关和 DNS 信息：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp3s0:</span></span><br><span class="line">      <span class="attr">addresses:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.2</span><span class="string">/24</span></span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">search:</span> [<span class="string">mydomain</span>, <span class="string">otherdomain</span>]</span><br><span class="line">        <span class="attr">addresses:</span> [<span class="number">10.10</span><span class="number">.10</span><span class="number">.1</span>, <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>]</span><br></pre></td></tr></table></figure>

<h2 id="连接多个接口使用-DHCP"><a href="#连接多个接口使用-DHCP" class="headerlink" title="连接多个接口使用 DHCP"></a>连接多个接口使用 DHCP</h2><p>现在，许多系统都包含多个网络接口。 服务器通常将需要连接到多个网络，并且可能要求到 Internet 的流量通过特定的接口，尽管它们都提供了有效的网关。</p>
<p>通过为通过 DHCP 检索的路由指定度量标准，可以实现 DHCP 所需的精确路由，这将确保某些路由优先于其他路由。 在此示例中， <code>enred</code> 优先于 <code>engreen</code> ，因为它具有较低的路由指标：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enred:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">dhcp4-overrides:</span></span><br><span class="line">        <span class="attr">route-metric:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">engreen:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">dhcp4-overrides:</span></span><br><span class="line">        <span class="attr">route-metric:</span> <span class="number">200</span></span><br></pre></td></tr></table></figure>

<h2 id="连接至开发无线网络"><a href="#连接至开发无线网络" class="headerlink" title="连接至开发无线网络"></a>连接至开发无线网络</h2><p>Netplan 轻松支持连接到开放的无线网络（该网络不受密码保护），只需要定义访问点即可：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">wifis:</span></span><br><span class="line">    <span class="attr">wl0:</span></span><br><span class="line">      <span class="attr">access-points:</span></span><br><span class="line">        <span class="attr">opennetwork:</span> &#123;&#125;</span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<h2 id="连接至-WPA-个人无线网络"><a href="#连接至-WPA-个人无线网络" class="headerlink" title="连接至 WPA 个人无线网络"></a>连接至 WPA 个人无线网络</h2><p>无线设备使用 <code>wifi</code> 键，并与有线以太网设备共享相同的配置选项。 还应指定无线接入点的名称和密码：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">  <span class="attr">wifis:</span></span><br><span class="line">    <span class="attr">wlp2s0b1:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">      <span class="attr">dhcp6:</span> <span class="literal">no</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.0</span><span class="number">.21</span><span class="string">/24</span>]</span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span>, <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>]</span><br><span class="line">      <span class="attr">access-points:</span></span><br><span class="line">        <span class="attr">&quot;network_ssid_name&quot;:</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">&quot;**********&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="连接到-WPA-企业无线网络"><a href="#连接到-WPA-企业无线网络" class="headerlink" title="连接到 WPA 企业无线网络"></a>连接到 WPA 企业无线网络</h2><p>找到使用 WPA 或 WPA2 Enterprise 保护的无线网络也是很常见的，这需要附加的身份验证参数。</p>
<p>例如，如果使用 WPA-EAP 和 TTLS 保护网络安全：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">wifis:</span></span><br><span class="line">    <span class="attr">wl0:</span></span><br><span class="line">      <span class="attr">access-points:</span></span><br><span class="line">        <span class="attr">workplace:</span></span><br><span class="line">          <span class="attr">auth:</span></span><br><span class="line">            <span class="attr">key-management:</span> <span class="string">eap</span></span><br><span class="line">            <span class="attr">method:</span> <span class="string">ttls</span></span><br><span class="line">            <span class="attr">anonymous-identity:</span> <span class="string">&quot;@internal.example.com&quot;</span></span><br><span class="line">            <span class="attr">identity:</span> <span class="string">&quot;joe@internal.example.com&quot;</span></span><br><span class="line">            <span class="attr">password:</span> <span class="string">&quot;v3ryS3kr1t&quot;</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<p>或者，如果使用 WPA-EAP 和 TLS 保护网络安全：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">wifis:</span></span><br><span class="line">    <span class="attr">wl0:</span></span><br><span class="line">      <span class="attr">access-points:</span></span><br><span class="line">        <span class="attr">university:</span></span><br><span class="line">          <span class="attr">auth:</span></span><br><span class="line">            <span class="attr">key-management:</span> <span class="string">eap</span></span><br><span class="line">            <span class="attr">method:</span> <span class="string">tls</span></span><br><span class="line">            <span class="attr">anonymous-identity:</span> <span class="string">&quot;@cust.example.com&quot;</span></span><br><span class="line">            <span class="attr">identity:</span> <span class="string">&quot;cert-joe@cust.example.com&quot;</span></span><br><span class="line">            <span class="attr">ca-certificate:</span> <span class="string">/etc/ssl/cust-cacrt.pem</span></span><br><span class="line">            <span class="attr">client-certificate:</span> <span class="string">/etc/ssl/cust-crt.pem</span></span><br><span class="line">            <span class="attr">client-key:</span> <span class="string">/etc/ssl/cust-key.pem</span></span><br><span class="line">            <span class="attr">client-key-password:</span> <span class="string">&quot;d3cryptPr1v4t3K3y&quot;</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<p>支持许多不同的加密模式。 <a target="_blank" rel="noopener" href="https://netplan.io/reference">请参阅 Netplan 参考页</a>。</p>
<h2 id="在单个接口上使用多个地址"><a href="#在单个接口上使用多个地址" class="headerlink" title="在单个接口上使用多个地址"></a>在单个接口上使用多个地址</h2><p>地址键可以获取要分配给接口的地址列表：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp3s0:</span></span><br><span class="line">      <span class="attr">addresses:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">10.100</span><span class="number">.1</span><span class="number">.38</span><span class="string">/24</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">10.100</span><span class="number">.1</span><span class="number">.39</span><span class="string">/24</span></span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">10.100</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>不支持接口别名（例如 eth0：0）。</p>
<h2 id="通过多个网关使用多个地址"><a href="#通过多个网关使用多个地址" class="headerlink" title="通过多个网关使用多个地址"></a>通过多个网关使用多个地址</h2><p>与上面的示例类似，具有多个地址的接口可以是配置有多个网关。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">    <span class="attr">ethernets:</span></span><br><span class="line">        <span class="attr">enp3s0:</span></span><br><span class="line">         <span class="attr">addresses:</span></span><br><span class="line">             <span class="bullet">-</span> <span class="number">9.0</span><span class="number">.0</span><span class="number">.9</span><span class="string">/24</span></span><br><span class="line">             <span class="bullet">-</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.10</span><span class="string">/24</span></span><br><span class="line">             <span class="bullet">-</span> <span class="number">11.0</span><span class="number">.0</span><span class="number">.11</span><span class="string">/24</span></span><br><span class="line">         <span class="comment">#gateway4:  # unset, since we configure routes below</span></span><br><span class="line">         <span class="attr">routes:</span></span><br><span class="line">             <span class="bullet">-</span> <span class="attr">to:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/0</span></span><br><span class="line">                 <span class="attr">via:</span> <span class="number">9.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">                 <span class="attr">metric:</span> <span class="number">100</span></span><br><span class="line">             <span class="bullet">-</span> <span class="attr">to:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/0</span></span><br><span class="line">                 <span class="attr">via:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">                 <span class="attr">metric:</span> <span class="number">100</span></span><br><span class="line">             <span class="bullet">-</span> <span class="attr">to:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/0</span></span><br><span class="line">                 <span class="attr">via:</span> <span class="number">11.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">                 <span class="attr">metric:</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>

<p>鉴于有多个地址，每个地址都有自己的网关，我们在此不指定 gateway4，而是使用子网的网关地址将各个路由配置为 0.0.0.0/0（任何地方）。 应该调整指标值，以便按预期进行路由。</p>
<p>DHCP 可用于接收接口的 IP 地址之一。 在这种情况下，该地址的默认路由将自动配置为度量值 100。作为路由下条目的简写形式，可以将 gateway4 设置为其中一个子网的网关地址。 在这种情况下，可以从路由中省略该子网的路由。 其指标将设置为 100。</p>
<h2 id="使用网络管理器作为渲染器"><a href="#使用网络管理器作为渲染器" class="headerlink" title="使用网络管理器作为渲染器"></a>使用网络管理器作为渲染器</h2><p>Netplan 同时支持网络和网络管理器作为后端。 您可以使用渲染器键指定应使用哪个网络后端来配置特定设备。 您还可以通过仅指定渲染器密钥将网络的所有配置委派给网络管理器本身：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">NetworkManager</span></span><br></pre></td></tr></table></figure>

<h2 id="配置接口绑定"><a href="#配置接口绑定" class="headerlink" title="配置接口绑定"></a>配置接口绑定</h2><p>通过使用物理接口列表和绑定模式声明绑定接口来配置绑定。 以下是使用 DHCP 获取地址的主动备份绑定的示例：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">  <span class="attr">bonds:</span></span><br><span class="line">    <span class="attr">bond0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">interfaces:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">enp3s0</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">enp4s0</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">active-backup</span></span><br><span class="line">        <span class="attr">primary:</span> <span class="string">enp3s0</span></span><br></pre></td></tr></table></figure>

<p>下面是一个充当具有各种绑定接口和不同类型的路由器的系统的示例。 请注意 <code>optional: true</code> 键声明，该声明允许进行引导而无需等待这些接口完全激活。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp1s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">    <span class="attr">enp2s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">    <span class="attr">enp3s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enp4s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enp5s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enp6s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">bonds:</span></span><br><span class="line">    <span class="attr">bond-lan:</span></span><br><span class="line">      <span class="attr">interfaces:</span> [<span class="string">enp2s0</span>, <span class="string">enp3s0</span>]</span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.93</span><span class="number">.2</span><span class="string">/24</span>]</span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">802.</span><span class="string">3ad</span></span><br><span class="line">        <span class="attr">mii-monitor-interval:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">bond-wan:</span></span><br><span class="line">      <span class="attr">interfaces:</span> [<span class="string">enp1s0</span>, <span class="string">enp4s0</span>]</span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.1</span><span class="number">.252</span><span class="string">/24</span>]</span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">search:</span> [<span class="string">local</span>]</span><br><span class="line">        <span class="attr">addresses:</span> [<span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>, <span class="number">8.8</span><span class="number">.4</span><span class="number">.4</span>]</span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">active-backup</span></span><br><span class="line">        <span class="attr">mii-monitor-interval:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">gratuitious-arp:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">bond-conntrack:</span></span><br><span class="line">      <span class="attr">interfaces:</span> [<span class="string">enp5s0</span>, <span class="string">enp6s0</span>]</span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.254</span><span class="number">.2</span><span class="string">/24</span>]</span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">balance-rr</span></span><br><span class="line">        <span class="attr">mii-monitor-interval:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="配置网桥"><a href="#配置网桥" class="headerlink" title="配置网桥"></a>配置网桥</h2><p>要创建一个由使用 DHCP 的单个设备组成的非常简单的网桥，请输入：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp3s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">bridges:</span></span><br><span class="line">    <span class="attr">br0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">interfaces:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">enp3s0</span></span><br></pre></td></tr></table></figure>

<p>一个更复杂的示例，要使 libvirtd 使用带有标记 vlan 的特定网桥，同时继续提供未标记的接口，将涉及：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp0s25:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">bridges:</span></span><br><span class="line">    <span class="attr">br0:</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">10.3</span><span class="number">.99</span><span class="number">.25</span><span class="string">/24</span>]</span><br><span class="line">      <span class="attr">interfaces:</span> [<span class="string">vlan15</span>]</span><br><span class="line">  <span class="attr">vlans:</span></span><br><span class="line">    <span class="attr">vlan15:</span></span><br><span class="line">      <span class="attr">accept-ra:</span> <span class="literal">no</span></span><br><span class="line">      <span class="attr">id:</span> <span class="number">15</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">enp0s25</span></span><br></pre></td></tr></table></figure>

<p>然后，通过将以下内容添加到 <code>/etc/libvirtd/ emu/networks/</code> 下的新 XML 文件中，将 libvirtd 配置为使用此桥。 <code>&lt;bridge&gt;</code> 标记以及 <code>&lt;name&gt;</code> 中的网桥名称需要与使用 netplan 配置的网桥设备的名称匹配：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">network</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>br0<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bridge</span> <span class="attr">name</span>=<span class="string">&#x27;br0&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">forward</span> <span class="attr">mode</span>=<span class="string">&quot;bridge&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="将-VLAN-附加到网络接口"><a href="#将-VLAN-附加到网络接口" class="headerlink" title="将 VLAN 附加到网络接口"></a>将 VLAN 附加到网络接口</h2><p>要使用重命名的接口配置多个 VLAN，请执行以下操作：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">mainif:</span></span><br><span class="line">      <span class="attr">match:</span></span><br><span class="line">        <span class="attr">macaddress:</span> <span class="string">&quot;de:ad:be:ef:ca:fe&quot;</span></span><br><span class="line">      <span class="attr">set-name:</span> <span class="string">mainif</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="string">&quot;10.3.0.5/23&quot;</span>]</span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">10.3</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">addresses:</span> [<span class="string">&quot;8.8.8.8&quot;</span>, <span class="string">&quot;8.8.4.4&quot;</span>]</span><br><span class="line">        <span class="attr">search:</span> [<span class="string">example.com</span>]</span><br><span class="line">  <span class="attr">vlans:</span></span><br><span class="line">    <span class="attr">vlan15:</span></span><br><span class="line">      <span class="attr">id:</span> <span class="number">15</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">mainif</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="string">&quot;10.3.99.5/24&quot;</span>]</span><br><span class="line">    <span class="attr">vlan10:</span></span><br><span class="line">      <span class="attr">id:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">mainif</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="string">&quot;10.3.98.5/24&quot;</span>]</span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="attr">addresses:</span> [<span class="string">&quot;127.0.0.1&quot;</span>]</span><br><span class="line">        <span class="attr">search:</span> [<span class="string">domain1.example.com</span>, <span class="string">domain2.example.com</span>]</span><br></pre></td></tr></table></figure>

<h2 id="到达直接连接的网关"><a href="#到达直接连接的网关" class="headerlink" title="到达直接连接的网关"></a>到达直接连接的网关</h2><p>这允许使用 <code>on-link</code> 关键字设置默认路由或任何路由，其中网关是直接连接到网络的 IP 地址，即使该地址与接口上配置的子网不匹配也是如此。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">    <span class="attr">ethernets:</span></span><br><span class="line">        <span class="attr">addresses:</span> [ <span class="string">&quot;10.10.10.1/24&quot;</span> ]</span><br><span class="line">        <span class="attr">routes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">to:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/0</span></span><br><span class="line">                <span class="attr">via:</span> <span class="number">9.9</span><span class="number">.9</span><span class="number">.9</span></span><br><span class="line">                <span class="attr">on-link:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>对于 IPv6，配置将非常相似，但显着的不同是附加的范围：将主机路由链接到所需的路由器地址：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">    <span class="attr">ethernets:</span></span><br><span class="line">        <span class="attr">addresses:</span> [ <span class="string">&quot;2001:cafe:face:beef::dead:dead/64&quot;</span> ]</span><br><span class="line">        <span class="attr">routes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">to:</span> <span class="string">&quot;2001:cafe:face::1/128&quot;</span></span><br><span class="line">                <span class="attr">scope:</span> <span class="string">link</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">to:</span> <span class="string">&quot;::/0&quot;</span></span><br><span class="line">                <span class="attr">via:</span> <span class="string">&quot;2001:cafe:face::1&quot;</span></span><br><span class="line">                <span class="attr">on-link:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="配置源路由"><a href="#配置源路由" class="headerlink" title="配置源路由"></a>配置源路由</h2><p>可以将路由表添加到特定接口，以允许在两个网络之间进行路由：</p>
<p>在下面的示例中，ens3 在 192.168.3.0/24 网络上，ens5 在 192.168.5.0/24 网络上。 这使任一网络上的客户端都可以连接到另一网络，并使响应来自正确的接口。</p>
<p>此外，默认路由仍分配给 ens5，允许任何其他流量通过。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">    <span class="attr">ethernets:</span></span><br><span class="line">        <span class="attr">ens3:</span></span><br><span class="line">            <span class="attr">addresses:</span></span><br><span class="line">             <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.3</span><span class="number">.30</span><span class="string">/24</span></span><br><span class="line">            <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">             <span class="bullet">-</span> <span class="attr">to:</span> <span class="number">192.168</span><span class="number">.3</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">                 <span class="attr">via:</span> <span class="number">192.168</span><span class="number">.3</span><span class="number">.1</span></span><br><span class="line">                 <span class="attr">table:</span> <span class="number">101</span></span><br><span class="line">            <span class="attr">routing-policy:</span></span><br><span class="line">             <span class="bullet">-</span> <span class="attr">from:</span> <span class="number">192.168</span><span class="number">.3</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">                 <span class="attr">table:</span> <span class="number">101</span></span><br><span class="line">        <span class="attr">ens5:</span></span><br><span class="line">            <span class="attr">addresses:</span></span><br><span class="line">             <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.5</span><span class="number">.24</span><span class="string">/24</span></span><br><span class="line">            <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">            <span class="attr">gateway4:</span> <span class="number">192.168</span><span class="number">.5</span><span class="number">.1</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">             <span class="bullet">-</span> <span class="attr">to:</span> <span class="number">192.168</span><span class="number">.5</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">                 <span class="attr">via:</span> <span class="number">192.168</span><span class="number">.5</span><span class="number">.1</span></span><br><span class="line">                 <span class="attr">table:</span> <span class="number">102</span></span><br><span class="line">            <span class="attr">routing-policy:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">from:</span> <span class="number">192.168</span><span class="number">.5</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">                <span class="attr">table:</span> <span class="number">102</span></span><br></pre></td></tr></table></figure>

<h2 id="配置回送接口"><a href="#配置回送接口" class="headerlink" title="配置回送接口"></a>配置回送接口</h2><p>Networkd 不允许创建新的回送设备，但是用户可以将新地址添加到标准回送接口 lo 中，以使其在计算机上以及自定义路由中被视为有效地址：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">lo:</span></span><br><span class="line">      <span class="attr">match:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">lo</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">7.7</span><span class="number">.7</span><span class="number">.7</span><span class="string">/32</span>]</span><br></pre></td></tr></table></figure>

<h2 id="与-Windows-DHCP-服务器集成"><a href="#与-Windows-DHCP-服务器集成" class="headerlink" title="与 Windows DHCP 服务器集成"></a>与 Windows DHCP 服务器集成</h2><p>对于 Windows Server 使用 dhcp-identifier 键提供 DHCP 的网络，可以实现互操作性：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp3s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">dhcp-identifier:</span> <span class="string">mac</span></span><br></pre></td></tr></table></figure>

<h2 id="连接-IP-隧道"><a href="#连接-IP-隧道" class="headerlink" title="连接 IP 隧道"></a>连接 IP 隧道</h2><p>隧道允许管理员配置两个连接特殊隧道接口并执行所需路由的端点，从而在 Internet 上扩展网络。 Netplan 支持 SIT，GRE，IP-in-IP（ipip，ipip6，ip6ip6），IP6GRE，VTI 和 VTI6 隧道。</p>
<p>隧道的常见用法是在仅支持 IPv4 的网络上启用 IPv6 连接。 下面的示例显示了如何配置这样的隧道。</p>
<p>这里的 1.1.1.1 是客户自己的 IP 地址； 2.2.2.2 是远程服务器的 IPv4 地址，<code>2001:dead:beef::2/64</code> 是隧道定义的客户端的 IPv6 地址，<code>2001:dead:beef::1</code> 是远程服务器的 IPv6 地址 。</p>
<p>最后，<code>2001:cafe:face::1/64</code> 是路由的 IPv6 前缀内的客户端地址：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">eth0:</span></span><br><span class="line">      <span class="attr">addresses:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span><span class="string">/24</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;2001:cafe:face::1/64&quot;</span></span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line">  <span class="attr">tunnels:</span></span><br><span class="line">    <span class="attr">he-ipv6:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">sit</span></span><br><span class="line">      <span class="attr">remote:</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line">      <span class="attr">local:</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">addresses:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;2001:dead:beef::2/64&quot;</span></span><br><span class="line">      <span class="attr">gateway6:</span> <span class="string">&quot;2001:dead:beef::1&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置-SR-IOV-虚拟功能"><a href="#配置-SR-IOV-虚拟功能" class="headerlink" title="配置 SR-IOV 虚拟功能"></a>配置 SR-IOV 虚拟功能</h2><p>对于 SR-IOV 网卡，可以为每个已配置的物理功能动态分配虚拟功能接口。 在 netplan 中，通过具有指向父 PF 的 link：属性来定义 VF。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">eno1:</span></span><br><span class="line">      <span class="attr">mtu:</span> <span class="number">9000</span></span><br><span class="line">    <span class="attr">enp1s16f1:</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">eno1</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="string">&quot;10.15.98.25/24&quot;</span>]</span><br><span class="line">    <span class="attr">vf1:</span></span><br><span class="line">      <span class="attr">match:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">enp1s16f[2-3]</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">eno1</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="string">&quot;10.15.99.25/24&quot;</span>]</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>Netplan 配置示例</p><p><a href="https://kainonly.com/ops/netplan/">https://kainonly.com/ops/netplan/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Kain</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-05-16</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-05-26</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="" rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/linux/">linux</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/front-end/npm/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Npm 常用命令</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/front-end/how_xss/"><span class="level-item">如何防止XSS攻击？</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://kainonly.com/ops/netplan/';
            this.page.identifier = 'ops/netplan/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'kains-note' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#配置"><span class="level-left"><span class="level-item">配置</span></span></a></li><li><a class="level is-mobile" href="#使用-DHCP-和-静态地址"><span class="level-left"><span class="level-item">使用 DHCP 和 静态地址</span></span></a></li><li><a class="level is-mobile" href="#连接多个接口使用-DHCP"><span class="level-left"><span class="level-item">连接多个接口使用 DHCP</span></span></a></li><li><a class="level is-mobile" href="#连接至开发无线网络"><span class="level-left"><span class="level-item">连接至开发无线网络</span></span></a></li><li><a class="level is-mobile" href="#连接至-WPA-个人无线网络"><span class="level-left"><span class="level-item">连接至 WPA 个人无线网络</span></span></a></li><li><a class="level is-mobile" href="#连接到-WPA-企业无线网络"><span class="level-left"><span class="level-item">连接到 WPA 企业无线网络</span></span></a></li><li><a class="level is-mobile" href="#在单个接口上使用多个地址"><span class="level-left"><span class="level-item">在单个接口上使用多个地址</span></span></a></li><li><a class="level is-mobile" href="#通过多个网关使用多个地址"><span class="level-left"><span class="level-item">通过多个网关使用多个地址</span></span></a></li><li><a class="level is-mobile" href="#使用网络管理器作为渲染器"><span class="level-left"><span class="level-item">使用网络管理器作为渲染器</span></span></a></li><li><a class="level is-mobile" href="#配置接口绑定"><span class="level-left"><span class="level-item">配置接口绑定</span></span></a></li><li><a class="level is-mobile" href="#配置网桥"><span class="level-left"><span class="level-item">配置网桥</span></span></a></li><li><a class="level is-mobile" href="#将-VLAN-附加到网络接口"><span class="level-left"><span class="level-item">将 VLAN 附加到网络接口</span></span></a></li><li><a class="level is-mobile" href="#到达直接连接的网关"><span class="level-left"><span class="level-item">到达直接连接的网关</span></span></a></li><li><a class="level is-mobile" href="#配置源路由"><span class="level-left"><span class="level-item">配置源路由</span></span></a></li><li><a class="level is-mobile" href="#配置回送接口"><span class="level-left"><span class="level-item">配置回送接口</span></span></a></li><li><a class="level is-mobile" href="#与-Windows-DHCP-服务器集成"><span class="level-left"><span class="level-item">与 Windows DHCP 服务器集成</span></span></a></li><li><a class="level is-mobile" href="#连接-IP-隧道"><span class="level-left"><span class="level-item">连接 IP 隧道</span></span></a></li><li><a class="level is-mobile" href="#配置-SR-IOV-虚拟功能"><span class="level-left"><span class="level-item">配置 SR-IOV 虚拟功能</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">前端技术</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">后端技术</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%89%8B%E8%AE%B0/"><span class="level-start"><span class="level-item">手记</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-start"><span class="level-item">数据库</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%BF%90%E7%BB%B4%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">运维技术</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/angular/"><span class="tag">angular</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/certbot/"><span class="tag">certbot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debian/"><span class="tag">debian</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debian-ubuntu/"><span class="tag">debian ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/emqx/"><span class="tag">emqx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/golang/"><span class="tag">golang</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lumen/"><span class="tag">lumen</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macos/"><span class="tag">macos</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nats/"><span class="tag">nats</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openssl/"><span class="tag">openssl</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/php/"><span class="tag">php</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgsql/"><span class="tag">postgsql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/satis/"><span class="tag">satis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shell/"><span class="tag">shell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/window/"><span class="tag">window</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="Kain&#039;s Notes" height="28"></a><p class="is-size-7"><span>&copy; 2021 Kain</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7"><a href="https://beian.miit.gov.cn" target="_blank">琼ICP备18004473号</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/kainonly"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>